- job-template:
    name: '{value_stream}_{name}_packaging-ezbake_multiproject_{scm_branch}'
    display-name: '{name} ({scm_branch}){dn-sort-index} Build pe-console-services'
    node: worker
    project-type: freestyle
    parameters:
        - string:
            name: PE_VER
            default: "{pe_family}"
            description: "Target PE Version"
    builders:
        - shell: !include-raw packaging-clj-lein-ezbake-multiproject.sh

    publishers:
        - trigger-parameterized-builds:
            - project: '{obj:tpb_projects}'
              predefined-parameters: '{tpb_predefined_parameters}'
              current-parameters: '{tpb_current_parameters}'
              condition: '{tpb_condition}'
              property-file: '.props'
              git-revision: '{tpb_git_revision}'

- job-template:
    name: '{value_stream}_pe-console-services_release_{scm_branch}'
    display-name: 'pe-console-services ({scm_branch}): Release & Promote to PE'
    node: worker
    project-type: freestyle
    parameters:
        - string:
            name: DEPLIST
            description: |
                Comma-separated list of leiningen deps and versions to set:
                <depname>=<version>[,<depname>=<version>[...]]
        - string:
            name: PE_VER
            default: '{pe_family}'
            description: "Target PE Version"
    builders:
        - shell:
            !include-raw clj-updatedeps.sh
        - shell:
            !include-raw release-nodeploy-clj.sh
    publishers:
        - trigger-parameterized-builds:
            - project: '{value_stream}_enterprise-dist_packaging_promotion'
              property-file: '.props'
              predefined-parameters:
                  PKG={name}
                  BRANCH={scm_branch}
              condition: UNSTABLE_OR_BETTER
