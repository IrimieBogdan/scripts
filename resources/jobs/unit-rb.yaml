- job-template:
    name: '{value_stream}_{name}_unit-ruby_{scm_branch}'
    meta_path_jobtemplate: 'resources/jobs/unit-rb.yaml'
    display-name: '{name} ({scm_branch}){dn-sort-index} Ruby Unit Test'
    project-type: matrix
    node: unit
    execution-strategy:
        combination-filter: '{combination-filter}'
    axes:
        - axis:
            type: slave
            name: label
            values:
                - unit
        - axis:
            type: user-defined
            name: RUBY_VER
            values: '{obj:unit_ruby_versions}'
    builders:
        - shell: !include-raw unit-rb.sh
    publishers:
        - trigger-parameterized-builds:
            - project: '{obj:tpb_projects}'
              predefined-parameters: '{obj:tpb_predefined_parameters}'
              current-parameters: '{obj:tpb_current_parameters}'
              condition: '{obj:tpb_condition}'
              property-file: '{obj:tpb_property_file}'
              git-revision: '{obj:tpb_git_revision}'

- job-template:
    name: '{value_stream}_puppet-license_unit-ruby_{scm_branch}'
    meta_path_jobtemplate: 'resources/jobs/unit-rb.yaml'
    display-name: '{name} ({scm_branch}){dn-sort-index} Ruby Unit Test'
    node: unit
    builders:
        - shell: !include-raw unit-license-cli.sh
    publishers:
        - trigger-parameterized-builds:
            - project: '{obj:tpb_projects}'
              predefined-parameters: '{obj:tpb_predefined_parameters}'
              current-parameters: '{obj:tpb_current_parameters}'
              condition: '{obj:tpb_condition}'
              property-file: '{obj:tpb_property_file}'
              git-revision: '{obj:tpb_git_revision}'

- job-template:
    name: '{value_stream}_live-management_unit-ruby_legacy-{scm_branch}'
    meta_path_jobtemplate: 'resources/jobs/unit-rb.yaml'
    display-name: '{name} ({scm_branch}){dn-sort-index} Ruby Unit Test'
    node: unit
    builders:
        - shell: !include-raw unit-live-management.sh
    publishers:
        - trigger-parameterized-builds:
            - project: '{obj:tpb_projects}'
              predefined-parameters: '{obj:tpb_predefined_parameters}'
              current-parameters: '{obj:tpb_current_parameters}'
              condition: '{obj:tpb_condition}'
              property-file: '{obj:tpb_property_file}'
              git-revision: '{obj:tpb_git_revision}'

- job-template:
    name: '{value_stream}_dashboard_unit-ruby_legacy-{scm_branch}'
    meta_path_jobtemplate: 'resources/jobs/unit-rb.yaml'
    display-name: '{name} ({scm_branch}){dn-sort-index} Ruby Unit Test'
    node: unit
    builders:
        - shell: !include-raw unit-dashboard.sh
    publishers:
        - trigger-parameterized-builds:
            - project: '{obj:tpb_projects}'
              predefined-parameters: '{obj:tpb_predefined_parameters}'
              current-parameters: '{obj:tpb_current_parameters}'
              condition: '{obj:tpb_condition}'
              property-file: '{obj:tpb_property_file}'
              git-revision: '{obj:tpb_git_revision}'

