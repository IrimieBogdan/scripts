- job-template:
    name: '{value_stream}_{name}_unit-js_grunt-{scm_branch}'
    meta_path_jobtemplate: 'resources/jobs/unit-js.yaml'
    display-name: '{name} ({scm_branch}){dn-sort-index} JS Unit Tests'
    node: unit
    builders:
        - shell:
            !include-raw unit-js-grunt.sh
    publishers:
        - cobertura:
            report-file: '{cobertura-report-file}'
            fail-no-reports: "true"
            targets:
                - line:
                    healthy: 8000000
                    unhealthy: 0
                    failing: 0
                - conditional:
                    healthy: 7000000
                    unhealthy: 0
                    failing: 0
        - junit:
            results:  '{junit-results}'
        - email:
            recipients:  'node-mgmt-ui@puppetlabs.com'
        - trigger-parameterized-builds:
            - project: '{obj:tpb_projects}'
              predefined-parameters: '{tpb_predefined_parameters}'
              current-parameters: '{tpb_current_parameters}'
              condition: '{tpb_condition}'
              property-file: '{tpb_property_file}'
              git-revision: '{tpb_git_revision}'

- job-template:
    name: '{value_stream}_{name}_unit-js_ember-cli_{scm_branch}'
    meta_path_jobtemplate: 'resources/jobs/unit-js.yaml'
    display-name: '{name} ({scm_branch}){dn-sort-index} JS Unit Tests'
    node: unit
    builders:
        - shell:
            !include-raw unit-js-ember-cli.sh
    publishers:
        - email:
            recipients:  'node-mgmt-ui@puppetlabs.com'
        - trigger-parameterized-builds:
            - project: '{obj:tpb_projects}'
              predefined-parameters: '{tpb_predefined_parameters}'
              current-parameters: '{tpb_current_parameters}'
              condition: '{tpb_condition}'
              property-file: '{tpb_property_file}'
              git-revision: '{obj:tpb_git_revision}'

- job-template:
    name: '{value_stream}_{name}_unit-js_mocha_{scm_branch}'
    meta_path_jobtemplate: 'resources/jobs/unit-js.yaml'
    display-name: '{name} ({scm_branch}){dn-sort-index} JS Unit Tests'
    node: unit
    builders:
        - shell:
            !include-raw unit-js-mocha.sh
    publishers:
        - email:
            recipients:  'node-mgmt-ui@puppetlabs.com'
        - trigger-parameterized-builds:
            - project: '{obj:tpb_projects}'
              predefined-parameters: '{tpb_predefined_parameters}'
              current-parameters: '{tpb_current_parameters}'
              condition: '{tpb_condition}'
              property-file: '{tpb_property_file}'
              git-revision: '{tpb_git_revision}'

- job-template:
    name: '{value_stream}_event-inspector_unit-javascript_legacy-{scm_branch}'
    meta_path_jobtemplate: 'resources/jobs/unit-js.yaml'
    display-name: '{name} ({scm_branch}){dn-sort-index} Javascript Unit Test'
    node: unit
    builders:
        - shell: !include-raw unit-js-event-inspector.sh
    publishers:
        - trigger-parameterized-build:
            tpb_projects: '{tpb_projects}'
            tpb_predefined_parameters: '{tpb_predefined_parameters}'
            tpb_current_parameters: '{tpb_current_parameters}'
            tpb_condition: '{tpb_condition}'
            tpb_property_file: '{tpb_property_file}'
            tpb_git_revision: '{tpb_git_revision}'

- job-template:
    name: '{value_stream}_certificate-manager_unit-javascript_legacy-{scm_branch}'
    meta_path_jobtemplate: 'resources/jobs/unit-js.yaml'
    display-name: '{name} ({scm_branch}){dn-sort-index} Javascript Unit Test'
    node: unit
    builders:
        - shell: !include-raw unit-js-certificate-manager.sh
    publishers:
        - trigger-parameterized-build:
            tpb_projects: '{tpb_projects}'
            tpb_predefined_parameters: '{tpb_predefined_parameters}'
            tpb_current_parameters: '{tpb_current_parameters}'
            tpb_condition: '{tpb_condition}'
            tpb_property_file: '{tpb_property_file}'
            tpb_git_revision: '{tpb_git_revision}'

- job-template:
    name: '{value_stream}_console_unit-javascript_legacy-{scm_branch}'
    meta_path_jobtemplate: 'resources/jobs/unit-js.yaml'
    display-name: '{name} ({scm_branch}){dn-sort-index} Javascript Unit Test'
    node: unit
    builders:
        - shell: !include-raw unit-js-console.sh
    publishers:
        - trigger-parameterized-build:
            tpb_projects: '{tpb_projects}'
            tpb_predefined_parameters: '{tpb_predefined_parameters}'
            tpb_current_parameters: '{tpb_current_parameters}'
            tpb_condition: '{tpb_condition}'
            tpb_property_file: '{tpb_property_file}'
            tpb_git_revision: '{tpb_git_revision}'
